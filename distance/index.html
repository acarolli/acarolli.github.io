<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medição de Distância AR.js com Coordenadas Geográficas</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene vr-mode-ui='enabled: false' 
        embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>
        <!-- Câmera para visualização com GPS ativado -->
        <a-entity camera gps-camera></a-entity>

        <!-- Adicione seu marcador de Realidade Aumentada -->
        <a-marker preset="hiro">
            <!-- Adicione o modelo 3D glTF com as coordenadas geográficas -->
            <a-entity gltf-model="./assets/treasure/scene.gltf" id="objetoAR" position="0 0 0" gps-entity-place="latitude: -19.973222; longitude: -43.969979; altitude: 990"></a-entity>

            <!-- Texto para mostrar quando próximo ao objeto -->
            <a-text id="textoProximo" position="0 1.5 -1.5" visible="false" value="Você está próximo de uma pista" align="center" width="4"></a-text>

            <!-- Botão para abrir o site quando próximo ao objeto -->
            <a-entity id="botaoSite" position="0 0 -1.5" visible="false" geometry="primitive: box; width: 1; height: 0.5; depth: 0.1" material="color: blue" text="value: Abrir site; align: center"></a-entity>
        </a-marker>
    </a-scene>

    <script>
        // Função para calcular a distância entre dois pontos em 3D
        function calcularDistancia(pontoA, pontoB) {
            return Math.sqrt(
                Math.pow(pontoA.x - pontoB.x, 2) +
                Math.pow(pontoA.y - pontoB.y, 2) +
                Math.pow(pontoA.z - pontoB.z, 2)
            );
        }

        // Atualização do frame
        AFRAME.registerComponent('atualizacao-frame', {
            tick: function () {
                // Obter a posição da câmera (celular)
                const camera = this.el.sceneEl.camera.el.object3D.getWorldPosition();

                // Obter a posição do objeto AR
                const objetoAR = this.el.object3D.getWorldPosition();

                // Calcular a distância entre a câmera e o objeto AR
                const distancia = calcularDistancia(camera, objetoAR);

                // Atualizar visibilidade do texto e botão baseado na distância
                const textoProximo = document.getElementById("textoProximo");
                const botaoSite = document.getElementById("botaoSite");

                if (distancia <= 500) {
                    textoProximo.setAttribute("visible", true);

                    if (distancia <= 10) {
                        botaoSite.setAttribute("visible", true);
                    } else {
                        botaoSite.setAttribute("visible", false);
                    }
                } else {
                    textoProximo.setAttribute("visible", false);
                    botaoSite.setAttribute("visible", false);
                }
            }
        });

        // Abrir o site ao clicar no botão
        document.getElementById("botaoSite").addEventListener("click", function() {
            window.open("https://seusite.com", "_blank");
        });
    </script>
</body>
</html>
