<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Ca√ßa Ao Tesouro - BH</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
    
    <link rel="stylesheet" type="text/css" href="./style.css"/>
</head>

<body style='margin: 0; overflow: hidden;'>
    <div class="top-text" id="topdiv"> </div>

    <a-scene
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; videoTexture: true; debugUIEnabled: false;"
    >
    <a-camera gps-new-camera rotation-reader></a-camera>

    <a-entity id="visible-object" gltf-model="./assets/treasure/scene.gltf" animation-mixer gps-new-entity-place="latitude: -19.987079; longitude: -43.963870" scale="0.2 0.2 0.2" visible="true"></a-entity>
    <a-entity id="invisible-object" gltf-model="./assets/treasure/scene.gltf" animation-mixer gps-new-entity-place="latitude: -19.987179; longitude: -43.963970" scale="0.2 0.2 0.2" visible="false"></a-entity>
    
    </a-scene>

<div  class="centered" >
    <div class="button" onclick="toggleVisibility()">Toggle Visibility</div>
</div>
    <div class="bottom-text" id="bottomdiv"> </div>

    <script>
        // Function to calculate distance between two coordinates
  function toggleVisibility() {
      var visibleObject = document.getElementById('visible-object');
      var invisibleObject = document.getElementById('invisible-object');

      if (visibleObject.getAttribute('visible') === true) {
        visibleObject.setAttribute('visible', false);
        invisibleObject.setAttribute('visible', true);
      } else {
        visibleObject.setAttribute('visible', true);
        invisibleObject.setAttribute('visible', false);
      }
    }

    window.addEventListener('load', () => {
    const camera = document.querySelector('[camera]');
    const chest = document.querySelector('visible-object');
    let check;

    chest.addEventListener('markerFound', () => {
        let cameraPosition = camera.object3D.position;
        let markerPosition = chest.object3D.position;
        let distance = cameraPosition.distanceTo(markerPosition)

        check = setInterval(() => {
            cameraPosition = camera.object3D.position;
            markerPosition = chest.object3D.position;
            distance = cameraPosition.distanceTo(markerPosition)

            // do what you want with the distance:
            console.log(distance);
            bottomdiv.innerHTML = 'Distancia: '+ distance.toFixed(2) + ' metros';
        }, 100);
    });

    chest.addEventListener('markerLost', () => {
      clearInterval(check);
    })
})
    </script>
    
</body>
</html>